<!DOCTYPE html>
<html lang="fr"> 
<head> 
  <title>Apprendre NodeJS avec Lovelace</title>
  <meta name="description" content="Bienvenue dans l'enfer NodeJS !" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="./css/style.css" />
</head> 
<body> 
  <h1><a id="toplink" href="#home"><span class="nomobile">Apprendre </span>NodeJS<span class="nomobile"> avec Lovelace</span></a></h1> 
  <nav>
    <a href="#menu" class="openmenu mobileonly">Menu</a>
    <ul id="menu" class="menu mobilehidden">
      <li><a class="chaplink" href="#installer">Installation<span class="mobileonly"> de NodeJS</span></a></li>
      <li><a class="chaplink" href="#npm"><span class="mobileonly">Apprendre à utiliser </span>NPM</a></li>
      <li><a href="#modules" class="chaplink"><span class="mobileonly">Découvrir les </span>Modules</a></li>
      <li><a class="chaplink" href="#serveur"><span class="mobileonly">Faire un </span>Serveur<span class="mobileonly"> en Node</span></a></li>
      <li><a href="#events" class="chaplink"><span class="mobileonly">Jongler avec les </span>Événements</a></li>
      <li><a class="chaplink" href="#socketio"><span class="mobileonly">Faites votre chat avec </span>socket.io</a></li>
      <li><a href="#express" class="chaplink"><span class="mobileonly">Exercices avec </span>Express</a></li>
    </ul>
  </nav>
  <section id="home" class="box">
    <h2>Ceci est un cours de Node.JS !</h2>
    <p>Ici, c'est l'enfer du JavaScript xénosensible: on a pas du tout envie d'utiliser Nginx ou Apache pour servir des pages web à nos visiteurs, et encore moins envie d'utiliser mille langages différents aux syntaxes exotiques. </p>
    <h3>Qu'est-ce que NodeJS</h3>
    <p>Il s'agit d'un framework en JavaScript. En gros, cela va vous permettre de créer des serveurs et des applications en n'utiliquant que du JavaScript. </p>
    <p>L'avantage de Node est de n'utiliser qu'un seul langage unificateur pour tous les morceaux de votre projet, plutôt que de jongler entre différents langages tels que le PHP, le Java, le XML, etc... </p>
    <h3>Les chapitres</h3>
    <ol>
      <li><a class="chaplink" href="#installer">Comment Installer NodeJS ?</a></li>
      <li><a class="chaplink" href="#npm">Apprendre à utiliser NPM</a></li>
      <li><a href="#modules" class="chaplink">Que sont les Modules ?</a></li>
      <li><a class="chaplink" href="#serveur">Faire un Serveur en Node</a></li>
      <li><a href="#events" class="chaplink">Jongler avec les Événements</a></li>
      <li><a class="chaplink" href="#socketio">Faites votre chat avec socket.io</a></li>
      <li><a href="#express" class="chaplink">Exercices avec Express</a></li>
    </ol>
    <h3>Le but de ce micro-site</h3>
    <p>Je vais tenter de vous montrer comment installer la dernière version de NodeJS sur votre machine et comment vous en servir à travers plusieurs chapitres faciles à comprendre. </p>
    <img src="./img/belongsinabrowser.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Vous pouvez passer au premier chapitre de ce cours en vous rendant sur <a class="btn chaplink" href="#installer">le chapitre d'installation</a></p>
  </section>
  <section id="installer" class="box hidden">
    <h2>Installer la dernière version de Node.JS</h2>
    <p>Bienvenue dans le premier chapitre de Node.</p>
    <p>Nous allons voir comment installer NodeJS et le mettre à jour à sa dernière version. Cela vous permettra d'utiliser le gestionnaire de package <b>NPM</b> pour installer des modules indispensables tels que <i>express</i> ou <i>socket.io</i> !</p>
    <p>Au cours de ce chapitre, nous allons également installer <b>NVM</b>, qui vous permettra de changer à volonté de version de NodeJS.</p>
    <h3 id="chap1p1">Télécharger NodeJS</h3>
    <p>
      Pour commencer, pas de surprise: vous devez installer NodeJS sur votre machine, et donc le télécharger. </p>
    <p>
      La méthode simple, rendez-vous <a href="https://nodejs.org/en/download/">sur le site officiel de Node</a>. <br>Sur cette page, vous avez une liste quasi-exhaustive de la plupart des systèmes d'exploitation. Choisissez le vôtre (moi c'est Windows 10 64bits) et lancez l'éxécutable, installez et bim. Vous aurez la toute dernière version de NodeJS ainsi que <b>NPM</b>. </p>
    <p>
      L'installation directe par l'exécutable, le deb, etc... peut parfois poser problème. <br>Je pense particulièrement aux utilisateurs de distributions Linux comme Debian, RHEL, etc... ou même aux utilisateurs qui préfèrent tout installer en lignes de commandes dans un terminal. </p>
    <h3 id="chap1p1a">Installation en lignes de commandes (Linux)</h3>
    <p>Pour beaucoup, l'utilisation du terminal peut-être assez effrayante. La vérité qui se cache derrière suit une logique pourtant assez simple. <br>Heureusement, je ne vous ferai pas un cours de lignes de commandes, je vais juste vous indiquer la méthode la plus simple pour installer Node tout en terminal.</p>
    <p>Si vous êtes sur Windows, je vous recommande d'utiliser le PowerShell en tant qu'administrateur. Si ça ne vous convient pas, vous pouvez utiliser des imitations du bash Linux pour Windows telles que <a href="http://babun.github.io/">Babun</a>. </p>
    <p>Nous avons besoin de télécharger et installer le paquet Node, commencez donc par ouvrir votre terminal. Entrez la commande suivante:</p>
    <div class="code">
      <pre><span class="sudo">sudo </span>apt-get install -y nodejs</pre>
    </div>
    <p>Vous avez donc maintenant NodeJS. </p>
    <p><i><b>Attention</b>, il se peut que NodeJS soit déjà installé dans votre distribution Linux, auquel cas vous aurez une erreur. Lancez juste la commande suivante pour vous assurer que l'installation c'est bien passée :</i></p>
    <div class="code">
      <pre><span class="sudo">node</span> -v </pre>
    </div>
    <p>Si je ne m'abuse, le terminal devrait vous dire que vous vous trouvez en version 4 ou quelque-chose en dessous de 6, ce qui nous embête pas mal car elle ne comprend ni gestionnaire de paquets, ni gestionnaire de version. <br>C'est pourquoi nous allons devoir installer <b>NVM</b> tout de suite !</p>
    <h3 id="chap1p2">Télécharger <b>NVM</b></h3>
    <p>Comme vous l'aurez sans doute compris, <b>NVM</b>, pour <strong>Node Version Manager</strong>, va vous permettre de gérer votre version de NodeJS. Seulement, le problème est qu'il n'est pas présent de base avec Node, nous allons donc l'installer !</p>
    <p>Une fois de plus, nous allons devoir taper une commande sur notre terminal :</p>
    <div class="code">
      <pre><span class="ret">curl</span> https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh | bash </pre>
    </div>
    <p>Après quoi, <b>NVM</b> devrait être installé. Pour vérifier cela, balancez cette commande dans le terminal :</p>
    <div class="code">
      <pre><span class="npm">nvm</span> --version</pre>
    </div>
    <h3 id="chap1p3">Mettre à jour NodeJS avec <b>NVM</b></h3>
    <p>Vous pouvez désormais installer la version actuelle de NodeJS à l'aide de <b>NVM</b> avec la petite ligne de terminal suivante:</p>
    <div class="code">
      <pre><span class="npm">nvm</span> install 9</pre>
    </div>
    <p>Quand c'est fait, le terminal devrait vous indiquer un message comme <br><cite>Now using node v9.2.0 (npm v5.5.1)</cite>.<br> Si c'est en effet le cas, félicitations, vous venez de finir ce chapitre avec succès !</p>
    <h3>Ensuite</h3>
    <p>Bon bon bon ! </p>
    <p>Vous disposez maintenant de NodeJS sur votre machine. Vous avez <b>NVM</b> pour gérer sa version et vous pouvez désormais utiliser <b>NPM</b>, qui est totalement indispensable si vous désirez développer vos propres applications en Node.</p>
    <p>Ne perdons donc pas une seconde et rendons-nous bien vite au <a href="#npm" class="btn chaplink">chapitre sur <b>NPM</b></a></p>
  </section>
  <section id="npm" class="box hidden">
    <h2>Utiliser <b>NPM</b></h2>
    <p>Ce chapitre va vous expliquer brièvement à quoi sert <b>NPM</b> et ce que sont les modules/packages que l'on peut installer dans un projet à l'aide de cet outil. </p>
    <p><b>NPM</b> (on l'a beaucoup lu en à peine 15 secondes, c'est chaud) signifie <strong>Node Package Manager</strong>. </p>
    <img src="./img/package.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Ce petit outil, néanmoins très complet, va nous permettre d'installer des modules (contenu dans les package) dans NodeJS ou plus spécifiquement dans nos projets.</p>
    <h3 id="chap2p2">Pourquoi s'en servir</h3>
    <p>Les modules vont vous permettre de créer des applications rapidement, sans devoir réinventer systématiquement la roue. Ils sont incontournables dans 99,99% des projets en NodeJS de nos jours. </p>
    <p>Même le serveur HTTP de ce site est fait en node et utilise plusieurs modules tels que <i>express</i> ou <i>ejs</i>. </p>
    <!--<h3 id="chap2p3">Comment s'en servir</h3>-->
    <h3>Initialiser un projet</h3>
    <p>Quand on initialise un projet avec <b>NPM</b>, celui ci créer un fichier package.json. Ce fichier contient non seulement le nom et la version du projet mais aussi, tout les modules utilisés par le projet.</p>
    <p>Cela vous servira à lister tout les modules dont vous avez besoin. Ce qui vous permettera de tous les réinstaller pas la suite en cas de besoin.</p>
    <p>Pour commencer, faites <i>cd</i> pour vous rendre dans un dossier où vous voulez créer votre projet. </p>
    <p>Comme pour <b>NVM</b>, <b>NPM</b> s'utilise en lignes de commandes via le terminal. Pour initialiser un projet , faites donc la commande suivante :</p>
    <div class="code">
      <pre><span class="npm">npm</span> init </pre>
    </div>
    <p><b>NPM</b> vous demandera le nom et la version du projet.Les modules que vous installerez y seront ajouté à la liste au moment ou vous les installerez. Par défaut, vous pouvez faire suivant à l'aveugle car vous pourrez configurer le tout plus tard. </p>
    <h3>Installation globale ou locale</h3>
    <p><b>NPM</b> s'utilise de deux manières. Vous pouvez soit installer un module globalement dans NodeJS, ce qui vous permettra de l'utiliser dans tous vos projets, soit installer un module uniquement dans un projet en particulier, si jamais vous n'en avez pas besoin ailleurs. </p>
    <p>Nous allons passer les deux méthodes en revue, vite fait, pour que vous compreniez un peu mieux de quoi il s'agit. </p>
    <h4>Globale</h4>
    <div class="code">
      <pre><span class="npm">npm</span> install <i>-g</i> <i>nodemon</i> </pre>
    </div>
    <p>Dans l'exemple ci-dessus, nous avons <cite>-g</cite> qui va servir à indiquer au manager que l'on souhaite installer un package globalement. <br>Dans cet exemple, le paquet en question est <i>nodemon</i>, il permet de relancer automatiquement un .js lorsqu'on le modifie. Ce paquet s'installer sans devoir trouver les dépendances vous-même, sans devoir écrire tous les fichiers de base qui font fonctionner ce genre d'applications. Vous gagnerez alors des heures de préparation.</p>
    <p>Dans cette méthode, l'avantage est de pouvoir utiliser le module <cite>nodemon</cite> où l'on veut. </p>
    <p>À l'opposé, nous avons la méthode d'installation locale, sans <i>-g</i> :</p>
    <h4>Locale</h4>
    <div class="code">
      <pre><span class="npm">npm</span> install <i>express</i> </pre>
    </div>
    <p>Cette commande plus courte permet d'installer, en l'occurence, <cite>express</cite> <strong>dans un projet existant</strong>.</p>
    <p>Notez que cette méthode installera le module uniquement dans le projet de votre choix. <i>Il convient bien entendu que votre terminal soit dans le bon répertoire sinon ça ne sert à rien.</i></p>
    <h3>Mettre un paquet à jour</h3>
    <div class="code">
      <pre><span class="npm">npm</span> update <b>-g</b> <i>nodemon</i> </pre>
    </div>
    <p>Cette commande de terminal va mettre à jour, dans cet exemple, le paquet <i>nodemon</i>. Si l'on ne met rien, le gestionnaire va mettre à jour tous les paquets.</p>
    <p>Utilisez <i>-g</i> pour choisir de mettre à jour tous vos paquets. Enlevez-le si vous voulez juste mettre à jour ceux du projet.</p>
    <img src="./img/update.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Dans tous les cas, <b>NPM</b> va trouver en ligne, dans une vaste base de donnée, tous les modules déjà créés auparavant par la communauté de NodeJS. Notez donc que sans connexion à Internet, vous ne pourrez pas faire fonctionner <b>NPM</b> correctement. </p>
    <p>Le site <a href="npmjs.com">npmjs.com</a> est la source depuis laquelle <b>NPM</b> télécharge tous les modules. Vous trouverez bien plus de renseignements sur <a href="https://docs.npmjs.com/">la documentation en ligne de npmjs.com</a>.</p>
    <h3 id="chap2p4">Quels modules choisir pour son projet</h3>
    <p>C'est une question pertinente. C'est une bonne question... une excellente question... </p>
    <p>Comme très souvent dans la vie de développeur, je vais devoir vous répondre "ça dépend". <br>Ça dépend de votre projet, de vos besoins, des fonctionnalités que vous allez vouloir développer ou utiliser.</p>
    <p>Avant de pouvoir commencer à utiliser les modules, il est très important de comprendre totalement ce qu'ils sont. Rendez-vous tout de suite sur le <a href="#modules" class="btn">Chapitre sur les modules</a> </p>
  </section>
  <section id="modules" class="box hidden">
    <h2>Les modules</h2>
      <p>Et voilà, encore un nouveau terme insensé et une nouvelle chose à apprendre… pas vraiment en fait .</p>
      <p>Par définition, un module est un fichier contenant plusieurs codes (variables, fonctions, objets, classes etc.) pouvant être appelés dans un autre fichier. Pensez un peu à vos links css ou vos scripts JS sur vos fichiers html, est bien c’est presque pareil ! Mais attention, je dis presque... <br>Comment cela fonctionne  ?</p>
      <p>Tout d’abord, il nous faut créer une page "app.js" sur laquelle écrire votre code</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun"><span class="fun">sayHelloInEnglish</span></span> = <span class="fun">function</span>() { </pre>
        <pre>&ensp;<span class="ret">return</span> <span class="sudo">"HELLO"</span>; </pre>
        <pre>} </pre>
      </div>
      <p>Une fois cela fait, il faut expliquer à l’ordinateur que nous voulons exporter cet élément pour l’utiliser sur une autre page JS, que nous allons appeler ici "  use.js "</p>
      <h3>L'export</h3>
      <p>Ici, rien de plus simple, à la fin de votre code, ajoutez :</p>
      <div class="code">
        <pre><span class="ret">module</span>.<span class="ret">exports</span>.<span class="sudo">[nom désiré]</span> =  <span class="sudo">"noms de variable/fonction/etc"</span>; </pre>
      </div>
      <p>Dans cet exemple, nous aurons ceci :</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun"><span class="fun">sayHelloInEnglish</span></span> = <span class="fun">function</span>() { </pre>
        <pre>&ensp;<span class="ret">return</span> "HELLO"; </pre>
        <pre>} </pre>
        <pre><span class="ret">module</span>.<span class="ret">exports</span>.English= <span class="fun">sayHelloInEnglish</span>; </pre>
      </div>
      <h3>Require</h3>
      <p>Maintenant que le module est exporté, il faut l’importer dans use.js. pour ce faire, il suffit d’utiliser la méthode "  require " dans le fichier use.js qui va aller chercher votre module et le rendre utilisable.</p>
      <p>Voici son mode d’emploi, premièrement la méthode doit être appelée dans une variable afin de pouvoir l’utiliser :</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun">Something</span>= <span class="fun">require</span>(); </pre>
      </div>
      <p>Puis il faut indiquer la position du module à la méthode require, tout comme le href dans un link css :</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun">Something</span>= <span class="fun">require</span>(<span class="sudo">"./app.js"</span>); </pre>
      </div>
      <p>Et voilà, votre fonction est importée, maintenant pour l’utiliser il vous suffit de l’appeler sous le nom de votre require plus le nom que vous avez donné à votre export (dans notre cas le <span class="fun">Something</span> et le English).</p>
      <p>Dans notre exemple :</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun">Something</span>= <span class="fun">require</span>(<span class="sudo">"./app.js"</span>); </pre>
        <pre>console.log(<span class="fun">Something</span>.English()); <span class="com">// va nous logger HELLO</span> </pre>
      </div>
      <p><b>Pourquoi devoir donner un nom à notre export ?</b></p>
      <p>Très souvent dans des modules, il n’y a pas qu’un seul élément, il faut donc donner un nom à nos différents éléments pour pouvoir les utiliser, par exemple :</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun">sayHelloInEnglish</span>= <span class="fun">function</span>() { </pre>
        <pre>&ensp;<span class="ret">return</span> "HELLO"; </pre>
        <pre>} </pre>
        <pre><span class="var">var</span> <span class="fun">sayHelloInSpanish</span>= <span class="fun">function</span>() { </pre>
        <pre>&ensp;<span class="ret">return</span> "Hola"; </pre>
        <pre>} </pre>
        <pre><span class="ret">module</span>.<span class="ret">exports</span>.English= <span class="fun">sayHelloInEnglish</span>; </pre>
        <pre><span class="ret">module</span>.<span class="ret">exports</span>.Spanish=  <span class="fun">sayHelloInSpanish</span>; </pre>
      </div>
      <p>Nous avons maintenant deux fonctions dans un seul module, toutes les deux importables et utilisables sous un seul et même require.</p>
      <div class="code">
        <pre><span class="var">var</span> <span class="fun">Something</span>= <span class="fun">require</span>(<span class="sudo">"./app.js"</span>); </pre>
        <pre>console.log(<span class="fun">Something</span>.English()); <span class="com">// va nous logger HELLO</span> </pre>
        <pre>console.log(<span class="fun">Something</span>.Spanish()); <span class="com">// va nous logger Hola</span> </pre>
      </div>
      <h3>Ensuite</h3>
      <p>Et voilà. <br>Pour plus d'info, n'hésitez pas à suivre <a href="https://www.youtube.com/watch?v=xHLd36QoS4k&list=PL4cUxeGkcC9gcy9lrvMJ75z9maRw4byYp&index=6">le cours de net ninja</a>, il est bien fait !</p>
      <img src="./img/iknowjs.gif" alt="NodeJS appartient au browser" class="largimg">
      <p>Maintenant que nous savons comment utiliser les outils de base, il convient d'apprendre à mettre une page en ligne avec NodeJS, rendez-vous sur le chapitre sur <a href="#serveur" class="btn">la création de serveur</a></p>
  </section>
  <section id="serveur" class="box hidden">
    <h2>Créer un serveur web avec Nodejs</h2>
    <p>Dans ce chapitre, nous allons apprendre à créer notre propre serveur web grâce à bibliothèque node, afin de communiquer du contenu à notre navigateur via les modules et méthodes que node nous propose.</p>
    <h3>Le module HTTP</h3>
    <p>Pour commencer nous aurons besoin de créer un fichier nommé "server.js" et d'y inclure le module "http", qui nous donnera les outils nécessaires, pour communiquer avec le navigateur via le protocole HTTP (Hyper Text Transfer Protocol):</p>
    <div class="code">
      <pre><span class="var">var</span> http = <span class="fun">require</span>(<span class="sudo">"http"</span>);</pre>
    </div>
    <h3>La méthode createServer</h3>
    <p>Une fois le module "http" inclus dans notre fichier "server.js", nous aurons accès à la méthode "<span class="ret">http</span>.<span class="fun">createServer</span>()" qui comme son nom l'indique, nous permettra de créer notre serveur. Cette méthode va nous passer deux paramètres : les objets request et response:</p>
    <div class="code">
      <pre><span class="var">var</span> server = <span class="ret">http</span>.<span class="fun">createServer</span>(<span class="fun">function</span>(request, response) {</pre>
      <pre>});</pre>
    </div>
    <h3>Les objets Request et Response</h3>
    <p>L'objet "request" va nous fournir des informations concernant la requête client tel que son url, les en-têtes HTTP,... <br>Tandis que l'objet "response" servira à retourner des données comme du texte, du html, un fichier,...</p>
    <p>Le but étant de communiquer du contenu à notre navigateur, ici seul l'objet "response" et quelques-unes de ces méthodes vont nous intéresser.</p>
    <p>La première étape consistera à appeler la méthode "response.writeHead()" qui va définir le statut de notre requête http ainsi que le type de contenu que l'on souhaite retourner.</p>
    <p>Ensuite "response.write()" va tout simplement, permettre de concevoir notre document html passé en arguement. <br>Et enfin "response.end()" viendra signifier la fin de notre réponse.</p>
    <div class="code">
      <pre><span class="ret">response</span>.<span class="fun">writeHead</span>(200, {<span class="sudo">"Content-Type"</span>: <span class="sudo">"text/html"</span>});</pre>
      <pre><span class="ret">response</span>.<span class="fun">write</span>(<span class="sudo">"</span></pre>
      <pre><span class="com">&#x3C;!DOCTYPE html&#x3E;</span></pre>
      <pre><span class="sudo">&#x3C;html lang=&#x22;en&#x22;&#x3E;</span></pre>
      <pre>&ensp;<span class="tag">&#x3C;head&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;meta</span> charset=<span class="sudo">&#x22;UTF-8&#x22;</span><span class="tag">&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;title&#x3E;</span>hello node<span class="tag">&#x3C;/title&#x3E;</span></pre>
      <pre>&ensp;<span class="tag">&#x3C;/head&#x3E;</span></pre>
      <pre>&ensp;<span class="tag">&#x3C;body&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;p&#x3E;</span>Hello world<span class="tag">&#x3C;/p&#x3E;</span></pre>
      <pre>&ensp;<span class="tag">&#x3C;/body&#x3E;</span></pre>
      <pre><span class="sudo">&#x3C;/html&#x3E;</span></pre> 
      <pre><span class="sudo">"</span>);</pre>
      <pre><span class="ret">response</span>.<span class="ret">end</span>();</pre>
    </div>
    <h3>La méthode listen</h3>
    <p>La dernière méthode appelée dans notre fichier sera "server.listen()", qui va lier notre serveur au port de notre choix. Ici nous utilisons le port 8080 mais comme mentionné juste avant, libre à vous d'utiliser un autre port afin d'accéder à votre seveur web:</p>
    <div class="code">
      <pre><span class="ret">server</span>.<span class="ret">listen</span>(8080);</pre>
    </div>
    <h3>Démarrer le serveur</h3>
    <p>Et voilà, Il ne nous reste plus qu'à démarrer notre serveur via le terminal grâce à ligne de commande ci-dessous et à admirer notre magnifique message "hello world" à l'adresse suivante: <a href="http://localhost:8080/">http://localhost:8080/</a></p>
    <div class="code">
      <pre><span class="npm">node</span> server.js</pre>
    </div>
    <p>Le code complet étant ceci :</p>
    <div class="code">
      <pre><span class="var">var</span> http = <span class="fun">require</span>(<span class="sudo">"http"</span>);</pre>
      <pre><span class="var">var</span> server = <span class="ret">http</span>.<span class="fun">createServer</span>(<span class="fun">function</span>(request, response) {</pre>
      <pre>&ensp;<span class="ret">response</span>.<span class="fun">writeHead</span>(200, {<span class="sudo">"Content-Type"</span>: <span class="sudo">"text/html"</span>});</pre>
      <pre>&ensp;<span class="ret">response</span>.<span class="fun">write</span>(<span class="sudo">"</span></pre>
      <pre>&ensp;<span class="com">&#x3C;!DOCTYPE html&#x3E;</span></pre>
      <pre>&ensp;<span class="sudo">&#x3C;html lang=&#x22;en&#x22;&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;head&#x3E;</span></pre>
      <pre>&ensp;&ensp;&ensp;<span class="tag">&#x3C;meta</span> charset=<span class="sudo">&#x22;UTF-8&#x22;</span><span class="tag">&#x3E;</span></pre>
      <pre>&ensp;&ensp;&ensp;<span class="tag">&#x3C;title&#x3E;</span>hello node<span class="tag">&#x3C;/title&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;/head&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;body&#x3E;</span></pre>
      <pre>&ensp;&ensp;&ensp;<span class="tag">&#x3C;p&#x3E;</span>Hello world<span class="tag">&#x3C;/p&#x3E;</span></pre>
      <pre>&ensp;&ensp;<span class="tag">&#x3C;/body&#x3E;</span></pre>
      <pre>&ensp;<span class="sudo">&#x3C;/html&#x3E;</span></pre> 
      <pre>&ensp;<span class="sudo">"</span>);</pre>
      <pre>&ensp;<span class="ret">response</span>.<span class="ret">end</span>();</pre>
      <pre>});</pre>
      <pre><span class="ret">server</span>.<span class="ret">listen</span>(8080);</pre>
    </div>
    <h3>Ensuite</h3>
    <img src="./img/servers.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Maintenant que votre serveur fonctionne et peut servir du HTML, il est temps d'apprendre comment échanger des informations avec ! Nous allons donc voir <a href="#events" class="btn">les événements</a></p>
  </section>
  <section id="events" class="box hidden">
    <h3>Les Événements</h3>
    <p>Votre serveur tourne désormais sur le port que vous avez choisi dans <i>listen()</i>.</p>
    <p>Il est temps de se pencher sur les événements. Vous vous rappelez de <i>addEventListener()</i> en JavaScript ? Cette fonction sert à exécuter du script lorsqu'un événements déclencheur se produit.</p>
    <p>En NodeJS, les événements fonctionnent un peu de la même manière, à la différence que les événements peuvent être créés, configurés et personnalisés selon vos besoin. </p>
    <p>Voici les événements existant par défaut dans NodeJS :</p>
    <div class="code">
      <pre><span class="var">var</span> fs = <span class="fun">require</span>(<span class="sudo">'fs'</span>);</pre>
      <pre><span class="var">var</span> rs = fs.<span class="fun">createReadStream</span>(<span class="sudo">'./fichier'</span>);</pre>
      <pre><span class="ret">rs</span>.<span class="fun">on</span>(<span class="sudo">'open'</span>, <span class="fun">function</span>() {</pre>
      <pre>&ensp;console.log(<span class="sudo">'Le fichier est maintenant ouvert!!!'</span>);</pre>
      <pre>}); </pre>
    </div>
    <p>Regardons un peu de plus près ce bout de code...</p>
    <p>En ligne 1 nous importons le module <i>fs</i>, et à la ligne 2, nous appelons la fonction <i>createReadStream()</i> de <i>fs</i> sur une nouvelle variable nommée <i>rs</i>.</p>
    <p>À la ligne 3, nous utilisons <i>rs</i> comme un objet pour y exécuter <i>on()</i> avec en premier paramètre <i>open</i>. Ce <i>on()</i> va nous permettre d'exécuter un script, une fonction. En l'occurence, le <i>console.log()</i> de la ligne 4 va s'éxécuter (sur <i>rs</i>) lorsque <i>'./fichier'</i> sera ouvert par l'utilisateur. </p>
    <h3>Créer ses propres événements</h3>
    <p>Nous venons de voir rapidement comment cela fonctionne. Maintenant, comme je vous l'ai dit, voyons comment nous pouvons créer nos propres événements pour pouvoir éxécuter toutes les tâches que l'on veut sur n'importe-quel événement. </p>
    <p>Notez que pour cela, il vous faudra importer le module <i>events</i> pour que cela fonctionne. Si vous avez oublié comment on fait, voici la commande terminale adéquate, à n'effectuer que dans la racine de votre projet car non globale.</p>
    <div class="code">
      <pre><span class="npm">npm</span> install <i>events</i></pre>
    </div>
    <p>Et ensuite, voici la syntaxe juste :</p>
    <div class="code"> 
      <pre><span class="var">var</span> events = <span class="fun">require</span>(<span class="sudo">'events'</span>);</pre>
      <pre><span class="var">var</span> eventEmitter = new <span class="ret">events</span>.<span class="fun">EventEmitter</span>(); </pre>
      <pre><span class="com">// Creation de l'évenement</span></pre>
      <pre><span class="var">var</span> myEvent = <span class="fun">function</span>() {</pre>
      <pre>&ensp;console.log(<span class="sudo">'Vive le terminal'</span>);</pre>
      <pre>}</pre>
      <pre><span class="com">// Application de l'événement à un cas</span></pre>
      <pre><span class="ret">eventEmitter</span>.<span class="fun">on</span>(<span class="sudo">'terminal'</span>, myEvent);</pre>
      <pre><span class="com">// Lance l'évenement "aimeTerminal"</span></pre>
      <pre><span class="ret">eventEmitter</span>.<span class="fun">emit</span>(<span class="sudo">'terminal'</span>);</pre>
    </div>
    <p>Comme vous le voyez, en ligne 1 nous avons importé le module <i>events</i> dans notre script à l'aide d'un <i>require()</i>. À la ligne suivante, nous avons créé un objet <i>eventEmitter</i> qui permettra de faire fonctionner nos événements.</p>
    <p>En ligne 4 nous créons une fonction <i>myEvent()</i> que l'on voudra déclencher sur événement. </p>
    <p>À la ligne 8, nous lançons notre fonction lorsque l'objet <i>eventEmitter</i> reçoit le signal <i>'terminal'</i>. L'objet écoute, ou attend, de recevoir ce signal. En deuxième paramètre de <i>on()</i>, nous indiquons la commande qui doit se déclencher, en l'occurence il s'agit de la fonction <i>myEvent()</i>. </p>
    <p>C'est à la ligne 10 que notre foncton s'éxécute. Ce n'est que si le <i>emit('terminal')</i> de la ligne 10 s'exécute que le <i>on()</i> que nous avons écrit en ligne 8 ne se lance. </p>
    <p>L'intérêt de <i>emit()</i> est qu'il peut s'éxécuter quand vous le désirez: à l'appui d'une touche, sur un lien, sur un bouton, etc... </p>
    <h3>Ensuite</h3>
    <p>C'est tout ce qu'il y a à retenir sur les événements. À partir de juste ça, vous devrez chipoter un bon moment pour créer des applications de plus en plus complexe. Je vous invite même à faire un grand tour sur <a href="https://nodejs.org/api/events.html">la documentation NodeJS</a> pour approfondir vos connaissances sur le sujet. Ne vous précipitez pas. </p>
    <img src="./img/hurry.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Une fois que vous êtes prêt, embarquez avec nous dans <a href="#socketio" class="btn">le chapitre sur les websocket</a></p>
  </section>
  <section id="socketio" class="box hidden">
    <h3>Les WebSocket</h3>
    <p>Les websockets c'est chouette !! Pourquoi me direz-vous? Parce que vous pouvez communiquer en temps réel entre la page web et node. Plus besoin de rafrachir la page pour afficher les nouvelles informations.</p>
    <p>La même page peut envoyer des informations sans passer par un formulaire et recevoir des infromations en direct et tout ça en javascript !</p>
    <img src="./img/nice.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>Du côté serveur, pour gerer les websocket avec nodeJS vous aurez besoin d'installer le module <i>socket.io</i>  avec <b>NPM</b>.</p>
    <p>Du côté client, Pour communiquer avec les websockets , vous aurez besoin d'inclure la version client de socket.io sur vos pages web : </p>
    <div class="code">
      <pre><span class="npm">&#x3C;script</span> src=<span class="sudo">"https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"</span><span class="tag">></span><span class="npm">&#x3C;/script></span></pre>
    </div>
    <h3>Fonctionnement de base</h3>
    <p>Pour initaliser socket io , il ne suffit pas de creer un objet,il faut aussi lui dire d'utiliser le server que vous aurez creer plus haut.</p>
    <div class="code">
      <pre><span class="var">var</span> io = <span class="fun">require</span>(<span class="sudo">'socket.io'</span>)(server);</pre>
    </div>
    <p>Avant d'utiliser socket.io,il faut que le server soit lié sur un port.</p>
    <div class="code">
      <pre><span class="ret">server</span>.<span class="ret">listen</span>(8080);</pre>
    </div>
    <p>La première chose à faire avant de recevoir ou envoyer des donner , c'est d'attendre que la connexion websocket soit établit avec la page web. Pour cela,il faudra attendre que l'évènement connection soit enclenché.</p>
    <div class="code">
      <pre><span class="ret">io</span>.<span class="ret">on</span>(<span class="sudo">'connection'</span>, <span class="fun">function</span>(socket) {</pre>
      <pre>});</pre>
    </div>
    <p>Pour se connecter côté client :</p>
    <div class="code">
      <pre><span class="var">var</span> socket = <span class="fun">io</span>(<span class="sudo">'http://localhost'</span>);</pre>
    </div>
    <p>Messages pour communiquer socketio utiliser des evenements,on peut d'un coté écouter un événement et le l'autre envoyer des messages à ces événements. On peut creer autant de type d'évenement que l'on veut mais aussi décider de n'en écouter que certain d'entre eux.</p>
    <p>Pour envoyer un evenement de type bienvenu au client par exemple (coté serveur):</p>
    <div class="code">
      <pre><span class="ret">socket</span>.<span class="ret">emit</span>(<span class="sudo">"bienvenue"</span>,<span class="sudo">"Bonjour ceci est votre 1ere connection"</span>);</pre>
    </div>
    <p>Et pour le recevoir côté client :</p>
    <div class="code">
      <pre><span class="ret">socket</span>.<span class="ret">on</span>(<span class="sudo">'bienvenue'</span>, <span class="fun">function</span>(data) {</pre>
      <pre>&ensp;<span class="fun">alert</span>(<span class="sudo">"le serveur nous dit :"</span>+data);</pre>
      <pre>});</pre>
    </div>
    <p>L'inverse est aussi possible ou le client envoye un message , et le server écoute.</p>
    <h2>Créer un chat avec socket.io</h2>
    <p>Vous ne vous y attendiez pas ! Voici un exercice ! :D</p>
    <p>Le but de cet exercice sera de creer un chat instantané trés simple qui devra:</p>
    <ol>
      <li>Prendre un pseudo et l'envoyer au server (pas de connexion ni mot de passe à gerer)(à gerer via socket.io aussi)</li>
      <li>Dans la même page,afficher le chat</li>
      <li>Envoyer et recevoir des message via socket.io</li>
    </ol>
    <h3>En bonus</h3>
    <p>Toute les variables que vous déclarer dans l'évenement de connection( coté server ) resterons spécifique à chaque utilisateur.</p>
    <div class="code">
      <pre><span class="ret">io</span>.<span class="ret">on</span>(<span class="sudo">'connection'</span>, <span class="fun">function</span>(socket) {</pre>
      <pre>&ensp;<span class="var">var</span> uneDonnéeParUtilisateur;</pre>
      <pre>});</pre>
    </div>
    <h3>Ensuite</h3>
    <p>Ce que vous venez d'apprendre durant ce chapitre fonctionne avec les événements. Lorsque vous aurez terminé votre chat en Node, découvrez nos <a class="btn" href="#express">exercices avec Express</a></p>
  </section>
  <section id="express" class="box hidden">
    <h2>Exercices avec express</h2>
    <p>Vu que j'ai beaucoup travaillé à intégrer le cours que nous avons rédigé à plusieurs, je vais me reposer et vous laisser réunir ce que l'on a vu précédemment dans deux exercices en express !</p>
    <img src="./img/exercices.gif" alt="NodeJS appartient au browser" class="largimg">
    <p>L'exercice c'est très important !</p>
    <h3>Exercice 1</h3>
    <p>Créer un petit projet avec une structure mvc en vous aidant d'express. <br>Le site doit comprendre :</p>
    <ol class="consign">
      <li>une page html avec un formulaire pour écrire le commentaire</li>
      <li>une page html avec un formulaire pour écrire le commentaire</li>
      <li>une page 404</li>
    </ol>
    <p>Organisez votre projet pour qu'en manipulant l'url, on ne puisse arriver que sur les pages citées ci-dessus. <br><i>(int: utilisez la methode "get" fournie par express)</i></p>
    <h3>Exercice 2</h3>
    <p>Reprendre la structure du projet précédent afin de créer un site permettant la pubication de commentaires.</p>
    <ol class="consign">
      <li>utilisez la methode POST fournie par express</li>
      <li>utiliser la page form afin de pouvoir récupérer les données envoyées par le formulaire dans un fichier json</li>
      <li>utiliser la page commentaire pour récupérer et afficher les commentaires qui sont écrit dans le fichier json</li>
    </ol>
    <p><i>(int: utilisez le module "fs")</i></p>
  </section>
  <footer>
    <p>Cours créé par la Startup Lovelace à <a href="http://becode.org/">BeCode.org</a></p>
    <!--
    Projet d'origine par :
    Axel Fiolle, Antoine Gjeloshaj, Kévin Somao, Valérian Thomas, Marvin Louis, Thomas Point, Jimmy Goossens, Caroline Bieuvelet, Kévin Flabat -->
    <small>Ce projet a été entièrement développé en NodeJS, bien entendu. ;) </small>
    <small>Le code source du projet disponible sur <a href="https://github.com/Andaroth/node-www">GitHub</a>. </small>
  </footer>
  <script src="./js/jquery.min.js"></script>
  <script src="./js/app.js"></script>
</body> 
</html>